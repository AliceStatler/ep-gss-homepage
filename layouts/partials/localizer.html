<script>
  document.addEventListener('readystatechange', event => { 

    if (event.target.readyState === "interactive") { 
      var baseURL = {{ .Site.BaseURL }};
      var permalink = {{ .Permalink }};
      var relativeLink = permalink.replace(baseURL, "");

      var searchPattern = new RegExp('^[a-z]{2}/.*');
      var isLocalizedURL = searchPattern.test(relativeLink);

      if (!isLocalizedURL) {

        // https://github.com/gohugoio/hugo/issues/4279#issue-288563807
        var getFirstBrowserLanguage = function () {
          var nav = window.navigator,
          browserLanguagePropertyKeys = ['language', 'browserLanguage', 'systemLanguage', 'userLanguage'],
          i,
          language

          if (Array.isArray(nav.languages)) {
            for (i = 0; i < nav.languages.length; i++) {
              language = nav.languages[i]
              if (language && language.length) {
                return language
              }
            }
          }

          // support for other well known properties in browsers
          for (i = 0; i < browserLanguagePropertyKeys.length; i++) {
            language = nav[browserLanguagePropertyKeys[i]]
            if (language && language.length) {
              return language
            }
          }
          return 'en'
        }

        var firstBrowserLanguage = getFirstBrowserLanguage();

        if (firstBrowserLanguage.startsWith('de')) {
          window.location.replace(baseURL + /de/ + relativeLink);
        } else {
          window.location.replace(baseURL + /en/ + relativeLink);
        }
      }
    }


});
  
  
</script>
